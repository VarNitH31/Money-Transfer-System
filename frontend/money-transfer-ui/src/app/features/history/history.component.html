<div class="history-layout">
  <section class="history-card">
    <header class="history-header">
      <button class="back-btn" (click)="goBack()">← Back</button>

      <div class="header-text">
        <h1>Transaction History</h1>
        <p>Review your past transfers and their statuses.</p>
      </div>
    </header>

    <!-- Filter Options: Tags -->
    <div class="filter-options">
      <div 
        class="filter-tag" 
        [class.selected]="transactionFilter() === 'all'"
        (click)="onFilterChange('all')">
        All
      </div>
      <div 
        class="filter-tag" 
        [class.selected]="transactionFilter() === 'debits'"
        (click)="onFilterChange('debits')">
        Debits
      </div>
      <div 
        class="filter-tag" 
        [class.selected]="transactionFilter() === 'credits'"
        (click)="onFilterChange('credits')">
        Credits
      </div>
    </div>

    <div class="alert alert-error" *ngIf="error()">
      {{ error() }}
    </div>

    <!-- Pagination controls: page size dropdown and info -->
    <div class="pagination-controls" *ngIf="!loading() && filteredTransactions().length">
      <div class="pagination-left">
        <label for="pageSizeSelect">Show</label>
        <select
          id="pageSizeSelect"
          class="page-size-select"
          [ngModel]="pageSize()"
          (ngModelChange)="onPageSizeChange($event)">
          <option *ngFor="let opt of pageSizeOptions" [value]="opt.value">{{ opt.label }}</option>
        </select>
        <span class="showing-info">
          Showing {{ startIndex }}-{{ endIndex }} of {{ filteredTransactions().length }}
        </span>
      </div>
      <div class="pagination-right">
        <button
          type="button"
          class="page-btn"
          [disabled]="currentPage() <= 1"
          (click)="goToPage(currentPage() - 1)">
          Previous
        </button>
        <span class="page-info">Page {{ currentPage() }} of {{ totalPages }}</span>
        <button
          type="button"
          class="page-btn"
          [disabled]="currentPage() >= totalPages"
          (click)="goToPage(currentPage() + 1)">
          Next
        </button>
      </div>
    </div>

    <div class="table-wrapper" *ngIf="!loading(); else loadingTpl">
      <table class="tx-table" *ngIf="filteredTransactions().length; else emptyTpl">
        <thead>
          <tr>
            <th>Date &amp; time</th>
            <th>From</th>
            <th>To</th>
            <th>Type</th>
            <th class="numeric">Amount</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let tx of paginatedTransactions()">
            <td>{{ tx.createdOn | date : 'medium' }}</td>
            <td>#{{ tx.fromAccountId }}</td>
            <td>#{{ tx.toAccountId }}</td>
            <td>
              <span
                class="badge"
                [class.badge-debit]="asDebit(tx)"
                [class.badge-credit]="!asDebit(tx)"
              >
                {{ asDebit(tx) ? 'DEBIT' : 'CREDIT' }}
              </span>
            </td>
            <td class="numeric">
              <span [ngClass]="{ debit: asDebit(tx), credit: !asDebit(tx) }">
                {{ asDebit(tx) ? '-' : '+' }}₹ {{ tx.amount | number : '1.2-2' }}
              </span>
            </td>
            <td>
              <span
                class="status-pill"
                [class.status-success]="tx.status === 'SUCCESS'"
                [class.status-failed]="tx.status === 'FAILED'"
              >
                {{ tx.status }}
              </span>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <ng-template #loadingTpl>
      <div class="loading">
        <div class="skeleton-row" *ngFor="let _ of [1,2,3,4]"></div>
      </div>
    </ng-template>

    <ng-template #emptyTpl>
      <div class="empty-state">
        <p>No transactions found yet.</p>
        <p class="hint">Create a transfer to see it appear here.</p>
      </div>
    </ng-template>
  </section>
</div>
